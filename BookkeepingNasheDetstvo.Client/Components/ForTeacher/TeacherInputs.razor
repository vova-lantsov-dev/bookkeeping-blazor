@inherits SessionController

<div class="w3-rest w3-mobile">
    <div class="w3-container w3-padding">
        <InputText Label="Фамилия" bind-Value-ValueChanged="@Teacher.LastName" />
        <InputText Label="Имя" bind-Value-ValueChanged="@Teacher.FirstName" />
        <InputText Label="Отчество" bind-Value-ValueChanged="@Teacher.SecondName" />
        <InputText Label="Номер телефона" bind-Value-ValueChanged="@Teacher.PhoneNumber" />
        <InputText Label="Электронный адрес" bind-Value-ValueChanged="@Teacher.Email" />
        <InputText Label="Ссылка на фото" bind-Value-ValueChanged="@Teacher.ImageUrl" />
        <InputText Label="Дополнительная информация" bind-Value-ValueChanged="@Teacher.Additional" />
        <InputDecimal Label="Оплата за час личного занятия" bind-Value-ValueChanged="@Teacher.PerHourPrivate" />
        <InputDecimal Label="Оплата за час группового занятия" bind-Value-ValueChanged="@Teacher.PerHourGroup" />
        <InputDecimal Label="Оплата за час консультации" bind-Value-ValueChanged="@Teacher.PerHourConsultation" />
    </div>
    <br />
    <div class="w3-container w3-padding">
        <InputCheckbox Label="Может менять личные данные детей" bind-Value-ValueChanged="@Teacher.EditChildren" />
        <br />
        <InputCheckbox Label="Может менять личные данные преподавателей" bind-Value-ValueChanged="@Teacher.EditTeachers" />
        <br />
        <InputCheckbox Label="Может менять расписание занятий" bind-Value-ValueChanged="@Teacher.EditSubjects" />
        <br />
        <InputCheckbox Label="Может просматривать статистику всех детей и преподавателей" bind-Value-ValueChanged="@Teacher.ReadGlobalStatistic" />
    </div>

    <HalfButtonSavingGroup DeleteAsync="@DeleteAsync" SaveAsync="@SaveAsync" IsBusy="@Busy" IsSaving="@Saving" IsSuccess="@Success" />

    @if (ReadGlobalStatistic)
    {
        <MyButton Color="blue" Click=@(async () => NavigateTo($"/statistic/teacher/{Teacher.Id}")) Text="Статистика" />
    }
</div>

@functions
{
    private bool Busy { get; set; }
    private bool Success { get; set; } = true;
    private bool Saving { get; set; }

    [Parameter]
    private TeacherModel Teacher { get; set; }

    [Parameter]
    private bool ReadGlobalStatistic { get; set; }

    private async Task SaveAsync()
    {
        if (Busy || Success)
        {
            return;
        }

        Busy = true;
        Saving = true;
        StateHasChanged();

        var teacherId = await PostAsync<string>("/api/teacher", Teacher);
        if (!string.IsNullOrEmpty(teacherId))
        {
            Teacher.Id = teacherId;
        }

        Busy = false;
        Success = true;
        StateHasChanged();
    }

    private async Task DeleteAsync()
    {
        if (Busy)
        {
            return;
        }

        Busy = true;
        Saving = false;
        StateHasChanged();

        await PostAsync<object>("/api/teacher/delete", Teacher.Id);
        NavigateTo("/teachers");
    }

    private void Edited()
    {
        Success = false;
        StateHasChanged();
    }
}