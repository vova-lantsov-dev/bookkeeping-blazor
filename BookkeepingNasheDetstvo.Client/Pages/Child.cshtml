@layout __Layout
@page "/child"
@page "/child/{Id}"
@inherits BookkeepingNasheDetstvo.Client.Components.ActionComponents.BaseComponent

<LoadingAction IsOk="@IsOk" CheckIfNullObject="@_child" NotOkText="Произошла ошибка при поиске ребёнка."
               NotOkSubmitButtonText="Вернуться назад" NotOkRedirectUrl="/children">
    <Avatar AvatarUrl=@_child.ImageUrl />
    if (Current?.EditTeachers ?? false)
    {
        <ChildInputs Base="child" Child=@_child ReadStatistic=@(Current?.ReadGlobalStatistics ?? false) />
    }
    else
    {
        <ChildReadOnly Child=@_child ReadStatistic=@(Current?.ReadGlobalStatistics ?? false) />
    }
</LoadingAction>

@functions {
    C _child;

    [Parameter]
    string Id { get; set; }

    protected override async Task OnInitAsync()
    {
        await CheckAccessToken();
        await LoadCurrent();
        _child = !string.IsNullOrEmpty(Id)
            ? await Get<C>($"/api/child/{Id}")
            : new C
            {
                FirstName = "",
                ImageUrl = "",
                LastName = "",
                SecondName = "",
                FatherName = "",
                FatherPhone = "+380",
                MotherName = "",
                MotherPhone = "+380",
                PerHour = 0m
            };

        IsOk = _child != default;
    }
}