@layout __Layout
@page "/"
@using System.Globalization
@inherits BaseComponent

<InputDateComponent Date="@_date" OnChange="@((DateTime dt) =>
                                              {
                                                  _date = dt;
                                                  UpdateDates();
                                                  StateHasChanged();
                                              })" />

@if (_dates.Count > 0)
{
    <ul class="w3-ul w3-card-4">
        @foreach (var date in _dates)
        {
            <SubjectsTable Date=@date CurrentId=@Current.Id WriteTeacherSubjects=@Current.EditSubjects />
        }
    </ul>
}

@functions {
    private readonly List<(string date, string name)> _dates = new List<(string date, string name)>();
    private readonly DateTimeFormatInfo _dtFormat = new CultureInfo("ru-RU").DateTimeFormat;
    private DateTime _date = DateTime.Today;

    protected override async Task OnInitAsync()
    {
        await CheckAccessToken();
        await LoadCurrent();
        
        UpdateDates();
    }

    private void UpdateDates()
    {
        var copyDate = _date;
        _dates.Clear();
        for (var i = 0; i < 7; i++)
        {
            if (copyDate.DayOfWeek != DayOfWeek.Sunday)
                _dates.Add((copyDate.ToString("dd-MM-yyyy"), _dtFormat.GetDayName(copyDate.DayOfWeek)));
            copyDate = copyDate.AddDays(1d);
        }
    }
}